<html>
	<head>
		<title>max_conn (max_connection)</title>
		<meta http-equiv=Content-Type content="text/html; charset=gbk">
		<link rel="stylesheet" href="../../public/css/Word2Chm.css" type="text/css" />
		<link rel="stylesheet" href="../../public/css/default.css" type="text/css" />
		<link rel="stylesheet" href="../../public/css/noframe.css" type="text/css" />
		<link rel="stylesheet" href="../../public/css/bootstrap.css" type="text/css" />
		<link rel="stylesheet" href="../../public/styles/shThemeDefault.css" type="text/css" />
		<script type="text/javascript" src="../../public/scripts/shCore.js"></script>
		<script type="text/javascript" src="../../public/scripts/shBrushPhp.js"></script>
		<script type="text/javascript">
			SyntaxHighlighter.defaults['gutter'] = false;
			SyntaxHighlighter.defaults['toolbar'] = false;
			SyntaxHighlighter.all();
		</script>
	</head>
	<body>
		<div class="wiki_content">
			<article>
				<h1>max_conn (max_connection)</h1>
				<p>
					服务器程序，最大允许的连接数，如max_conn => 10000,
					此参数用来设置Server最大允许维持多少个tcp连接。超过此数量后，新进入的连接将被拒绝。
				</p>
				<ul>
					<li>max_connection最大不得超过操作系统ulimit
						-n的值，否则会报一条警告信息，并重置为ulimit -n的值</li>
					<li>max_connection默认值为ulimit -n的值</li>
				</ul>
				<pre class="brush: php;">WARN    swServer_start_check: serv->max_conn is exceed the maximum value[100000].
</pre>
				<blockquote>
					<p>
						此参数不要调整的过大，根据机器内存的实际情况来设置。Swoole会根据此数值一次性分配一块大内存来保存Connection信息
					</p>
				</blockquote>

				<h2>最小设置</h2>

				<p>
					此选项设置过小底层会抛出错误，并设置为<code>ulimit -n</code>的值。
				</p>

				<blockquote>
					<p>
						最小值为<code>(serv->worker_num + SwooleG.task_worker_num) * 2 + 32</code>
					</p>
				</blockquote>
				<pre class="brush:php;">serv->max_connection is too small.
</pre>

			</article>
		</div>
	</body>
</html>
