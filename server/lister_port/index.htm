<html class="translated-ltr"><head>
	<title>Listening port</title>
	<meta http-equiv="Content-Type" content="text/html; charset=gbk">
	<link rel="stylesheet" href="../../public/css/Word2Chm.css" type="text/css">
	<link rel="stylesheet" href="../../public/css/default.css" type="text/css">
	<link rel="stylesheet" href="../../public/css/noframe.css" type="text/css">
	<link rel="stylesheet" href="../../public/css/bootstrap.css" type="text/css">
	<link rel="stylesheet" href="../../public/styles/shThemeDefault.css" type="text/css">
	<script type="text/javascript" src="../../public/scripts/shCore.js"></script>
	<script type="text/javascript" src="../../public/scripts/shBrushPhp.js"></script>
	<script type="text/javascript">
		SyntaxHighlighter.defaults['gutter'] = false;
		SyntaxHighlighter.defaults['toolbar'] = false;
		SyntaxHighlighter.all();
	</script>
<link type="text/css" rel="stylesheet" charset="UTF-8" href="https://translate.googleapis.com/translate_static/css/translateelement.css"></head>
<body>
	<div class="wiki_content">
		<article>
			<h1><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Listening port</font></font></h1>
			<p>
				<code>Swoole-1.8.0</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Added to </font></font><code>多端口混合协议</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">support. </font></font><code>Server</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">You can listen to multiple ports, each of which can be set to different protocol processing (set) and callback function (on). </font></font><code>SSL/TLS</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Transport encryption can also be enabled only for specific ports.
			</font></font></p>
			<ul>
				<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Listening port with no protocol processing option set, no protocol mode is used by default</font></font></li>
				<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">The listener port of the callback function is not set, using the </font></font><code>$server</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">object's callback function</font></font></li>
				<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">The object type returned by the listening port is</font></font><code>swoole_server_port</code></li>
				<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">The callback function of different listening ports is still executed in the same Worker process space.</font></font></li>
			</ul>
			<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Listen for new ports</font></font></h2>
			<div><div id="highlighter_752963" class="syntaxhighlighter nogutter  php"><table border="0" cellpadding="0" cellspacing="0"><tbody><tr><td class="code"><div class="container"><div class="line number1 index0 alt2"><code class="php variable">$port1</code> <code class="php plain">= </code><code class="php variable">$server</code><code class="php plain">-&gt;listen(</code><code class="php string">"127.0.0.1"</code><code class="php plain">, 9501, SWOOLE_SOCK_TCP);</code></div><div class="line number2 index1 alt1"><code class="php variable">$port2</code> <code class="php plain">= </code><code class="php variable">$server</code><code class="php plain">-&gt;listen(</code><code class="php string">"127.0.0.1"</code><code class="php plain">, 9502, SWOOLE_SOCK_UDP);</code></div><div class="line number3 index2 alt2"><code class="php variable">$port3</code> <code class="php plain">= </code><code class="php variable">$server</code><code class="php plain">-&gt;listen(</code><code class="php string">"127.0.0.1"</code><code class="php plain">, 9502, SWOOLE_SOCK_TCP | SWOOLE_SSL);</code></div></div></td></tr></tbody></table></div></div>
			<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Set up network protocol</font></font></h2>
			<div><div id="highlighter_941009" class="syntaxhighlighter nogutter  php"><table border="0" cellpadding="0" cellspacing="0"><tbody><tr><td class="code"><div class="container"><div class="line number1 index0 alt2"><code class="php variable">$port1</code><code class="php plain">-&gt;set(</code></div><div class="line number2 index1 alt1"><code class="php spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="php string">'open_length_check'</code> <code class="php plain">=&gt; true,</code></div><div class="line number3 index2 alt2"><code class="php spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="php string">'package_length_type'</code> <code class="php plain">=&gt; </code><code class="php string">'N'</code><code class="php plain">,</code></div><div class="line number4 index3 alt1"><code class="php spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="php string">'package_length_offset'</code> <code class="php plain">=&gt; 0,</code></div><div class="line number5 index4 alt2"><code class="php spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="php string">'package_max_length'</code> <code class="php plain">=&gt; 800000,</code></div><div class="line number6 index5 alt1"><code class="php plain">);</code></div><div class="line number7 index6 alt2">&nbsp;</div><div class="line number8 index7 alt1"><code class="php variable">$port3</code><code class="php plain">-&gt;set(</code></div><div class="line number9 index8 alt2"><code class="php spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="php string">'open_eof_split'</code> <code class="php plain">=&gt; true,</code></div><div class="line number10 index9 alt1"><code class="php spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="php string">'package_eof'</code> <code class="php plain">=&gt; </code><code class="php string">"\r\n"</code><code class="php plain">,</code></div><div class="line number11 index10 alt2"><code class="php spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="php string">'ssl_cert_file'</code> <code class="php plain">=&gt; </code><code class="php string">'ssl.cert'</code><code class="php plain">,</code></div><div class="line number12 index11 alt1"><code class="php spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="php string">'ssl_key_file'</code> <code class="php plain">=&gt; </code><code class="php string">'ssl.key'</code><code class="php plain">,</code></div><div class="line number13 index12 alt2"><code class="php plain">);</code></div></div></td></tr></tbody></table></div></div>
			<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Set callback function</font></font></h2>
			<div><div id="highlighter_715164" class="syntaxhighlighter nogutter  php"><table border="0" cellpadding="0" cellspacing="0"><tbody><tr><td class="code"><div class="container"><div class="line number1 index0 alt2"><code class="php variable">$port1</code><code class="php plain">-&gt;on(</code><code class="php string">'connect'</code><code class="php plain">, </code><code class="php keyword">function</code> <code class="php plain">(</code><code class="php variable">$serv</code><code class="php plain">, </code><code class="php variable">$fd</code><code class="php plain">){</code></div><div class="line number2 index1 alt1"><code class="php spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="php functions">echo</code> <code class="php string">"Client:Connect.\n"</code><code class="php plain">;</code></div><div class="line number3 index2 alt2"><code class="php plain">});</code></div><div class="line number4 index3 alt1">&nbsp;</div><div class="line number5 index4 alt2"><code class="php variable">$port1</code><code class="php plain">-&gt;on(</code><code class="php string">'receive'</code><code class="php plain">, </code><code class="php keyword">function</code> <code class="php plain">(</code><code class="php variable">$serv</code><code class="php plain">, </code><code class="php variable">$fd</code><code class="php plain">, </code><code class="php variable">$from_id</code><code class="php plain">, </code><code class="php variable">$data</code><code class="php plain">) {</code></div><div class="line number6 index5 alt1"><code class="php spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="php variable">$serv</code><code class="php plain">-&gt;send(</code><code class="php variable">$fd</code><code class="php plain">, </code><code class="php string">'Swoole: '</code><code class="php plain">.</code><code class="php variable">$data</code><code class="php plain">);</code></div><div class="line number7 index6 alt2"><code class="php spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="php variable">$serv</code><code class="php plain">-&gt;close(</code><code class="php variable">$fd</code><code class="php plain">);</code></div><div class="line number8 index7 alt1"><code class="php plain">});</code></div><div class="line number9 index8 alt2">&nbsp;</div><div class="line number10 index9 alt1"><code class="php variable">$port1</code><code class="php plain">-&gt;on(</code><code class="php string">'close'</code><code class="php plain">, </code><code class="php keyword">function</code> <code class="php plain">(</code><code class="php variable">$serv</code><code class="php plain">, </code><code class="php variable">$fd</code><code class="php plain">) {</code></div><div class="line number11 index10 alt2"><code class="php spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="php functions">echo</code> <code class="php string">"Client: Close.\n"</code><code class="php plain">;</code></div><div class="line number12 index11 alt1"><code class="php plain">});</code></div><div class="line number13 index12 alt2">&nbsp;</div><div class="line number14 index13 alt1"><code class="php variable">$port2</code><code class="php plain">-&gt;on(</code><code class="php string">'packet'</code><code class="php plain">, </code><code class="php keyword">function</code> <code class="php plain">(</code><code class="php variable">$serv</code><code class="php plain">, </code><code class="php variable">$data</code><code class="php plain">, </code><code class="php variable">$addr</code><code class="php plain">) {</code></div><div class="line number15 index14 alt2"><code class="php spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="php plain">var_dump(</code><code class="php variable">$data</code><code class="php plain">, </code><code class="php variable">$addr</code><code class="php plain">);</code></div><div class="line number16 index15 alt1"><code class="php plain">});</code></div></div></td></tr></tbody></table></div></div>
			<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Http/WebSocket</font></font></h2>
			<p>
				<code>swoole_http_server</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">And </font></font><code>swoole_websocket_server</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">because it is implemented using subclasses can not be used </font></font><code>listen</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">to create </font></font><code>Http/WebSocket</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">server. </font><font style="vertical-align: inherit;">If the main function of the server is </font></font><code>RPC</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">, but want to provide a simple web management interface.
			</font></font></p>
			<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
				In such a scenario, you can create </font></font><code>Http/WebSocket</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">a server, and then the </font></font><code>listen</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">monitor </font></font><code>RPC服务器</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">port.
			</font></font></p>
		</article>
	</div><div id="goog-gt-tt" class="skiptranslate" dir="ltr"><div style="padding: 8px;"><div><div class="logo"><img src="https://www.gstatic.com/images/branding/product/1x/translate_24dp.png" width="20" height="20" alt="Google Translate"></div></div></div><div class="top" style="padding: 8px; float: left; width: 100%;"><h1 class="title gray">Original text</h1></div><div class="middle" style="padding: 8px;"><div class="original-text"></div></div><div class="bottom" style="padding: 8px;"><div class="activity-links"><span class="activity-link">Contribute a better translation</span><span class="activity-link"></span></div><div class="started-activity-container"><hr style="color: #CCC; background-color: #CCC; height: 1px; border: none;"><div class="activity-root"></div></div></div><div class="status-message" style="display: none;"></div></div>


<div class="goog-te-spinner-pos"><div class="goog-te-spinner-animation"><svg xmlns="http://www.w3.org/2000/svg" class="goog-te-spinner" width="96px" height="96px" viewBox="0 0 66 66"><circle class="goog-te-spinner-path" fill="none" stroke-width="6" stroke-linecap="round" cx="33" cy="33" r="30"></circle></svg></div></div></body></html>